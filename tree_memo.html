<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒ³ æ¨¹å½¢å›³ãƒ¡ãƒ¢ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ / GitHub Pageså¯¾å¿œï¼‰</title>
  <meta name="description" content="ã‚·ãƒ³ã‚°ãƒ«HTMLã§å‹•ãæ¨¹å½¢å›³ãƒ¡ãƒ¢ã€‚localStorageä¿å­˜ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯¾å¿œã€‚ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ã€‚" />
  <style>
    /* --------- åŸºæœ¬ãƒ†ãƒ¼ãƒï¼ˆè‡ªå‹•ã§ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ï¼‰ --------- */
    :root{
      --bg:#0b1020; --surface:#111932; --card:#161f3a; --ink:#e8eefc; --muted:#a5b4d8; --accent:#74a7ff;
      --line:#24325c; --line2:#33416c; --ink2:#cfe0ff; --chip:#0f1836;
      --tap:44px; /* ã‚¿ãƒƒãƒ—é ˜åŸŸåŸºæº– */
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f9fe; --surface:#ffffff; --card:#f5f7ff; --ink:#0f1b3a; --muted:#5a6b93; --accent:#2d6bff;
        --line:#dee5ff; --line2:#cdd7ff; --ink2:#1d2a55; --chip:#eef2ff;
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans JP',sans-serif}

    /* --------- ãƒ˜ãƒƒãƒ€ãƒ¼ --------- */
    header{position:sticky;top:0;z-index:20;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px;background:linear-gradient(180deg,rgba(0,0,0,.28),transparent), var(--surface);border-bottom:1px solid var(--line)}
    .title{font-weight:700;letter-spacing:.01em}
    .right{display:flex;gap:8px;align-items:center}
    .pill{display:inline-flex;align-items:center;gap:6px;height:28px;padding:0 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:.85rem;background:var(--chip)}

    /* --------- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --------- */
    .wrap{max-width:1100px;margin:0 auto;padding:10px 12px 28px}
    .toolbar{position:sticky;top:56px;z-index:10;display:flex;flex-wrap:wrap;gap:8px;margin:8px 0;padding:6px 0}
    button{min-height:var(--tap);padding:8px 12px;background:var(--card);border:1px solid var(--line);border-radius:12px;color:var(--ink);cursor:pointer}
    button:active{transform:translateY(1px)}
    button:hover{border-color:var(--accent)}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }

    .card{background:var(--surface);border:1px solid var(--line);border-radius:16px;padding:12px}
    .hint{color:var(--muted);font-size:.9rem}

    /* --------- ãƒ„ãƒªãƒ¼ --------- */
    ul.tree{list-style:none;padding-left:10px;margin:0}
    ul.tree li{margin:4px 0;padding-left:12px;position:relative}
    ul.tree li::before{content:"";position:absolute;left:0;top:0.95em;width:8px;height:1px;background:var(--line2)}
    .node{display:flex;align-items:center;gap:8px;padding:6px;border-radius:10px}
    .node .label{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .toggle{width:26px;height:26px;display:inline-grid;place-items:center;border:1px solid var(--line2);border-radius:8px;cursor:pointer;font-size:13px;color:var(--ink2);background:var(--chip)}
    .toggle.hidden{visibility:hidden}
    .node.selected{outline:2px solid var(--accent);background:var(--chip)}

    /* --------- ãƒ•ã‚©ãƒ¼ãƒ  --------- */
    input[type="text"], textarea{width:100%;background:var(--chip);color:var(--ink);border:1px solid var(--line2);border-radius:12px;padding:10px;font-size:16px}
    textarea{min-height:180px}
    label.small{display:block;margin-bottom:6px;color:var(--muted);font-size:.85rem}

    .footer{margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;align-items:center;color:var(--muted);font-size:.9rem}
    a{color:var(--accent)}

    .help{margin-top:12px}
    details{background:var(--surface);border:1px dashed var(--line);border-radius:12px;padding:10px}
    summary{cursor:pointer;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="title">ğŸŒ³ æ¨¹å½¢å›³ãƒ¡ãƒ¢ï¼ˆURLå…¬é–‹OK / ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</div>
    <div class="right">
      <span id="saveState" class="pill">æœªä¿å­˜</span>
    </div>
  </header>

  <div class="wrap">
    <div class="toolbar" role="group" aria-label="æ“ä½œãƒ„ãƒ¼ãƒ«">
      <button id="addRoot" aria-label="ãƒ«ãƒ¼ãƒˆè¿½åŠ ">ï¼‹ ãƒ«ãƒ¼ãƒˆè¿½åŠ </button>
      <button id="addChild" aria-label="å­ãƒãƒ¼ãƒ‰è¿½åŠ ">ï¼‹ å­ãƒãƒ¼ãƒ‰</button>
      <button id="renameNode" aria-label="åå‰å¤‰æ›´">âœï¸ åå‰å¤‰æ›´</button>
      <button id="deleteNode" aria-label="å‰Šé™¤">ğŸ—‘ï¸ å‰Šé™¤</button>
      <button id="expandAll" aria-label="ã™ã¹ã¦å±•é–‹">â›“ ã™ã¹ã¦å±•é–‹</button>
      <button id="collapseAll" aria-label="ã™ã¹ã¦ç•³ã‚€">ğŸ”— ã™ã¹ã¦ç•³ã‚€</button>
      <button id="exportJson" aria-label="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">â¬‡ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <button id="importJson" aria-label="ã‚¤ãƒ³ãƒãƒ¼ãƒˆ">â¬†ï¸ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
      <button id="resetAll" aria-label="å…¨å‰Šé™¤">ğŸ§¹ å…¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>

    <div class="grid">
      <div class="card" aria-live="polite">
        <ul id="tree" class="tree"></ul>
        <div class="footer">
          <div>é¸æŠä¸­ãƒ‘ã‚¹: <span id="selectedPath" class="muted">â€”</span></div>
          <div>æœ€çµ‚ä¿å­˜: <span id="lastSaved" class="muted">â€”</span></div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:4px 0 6px">ãƒãƒ¼ãƒ‰è©³ç´°</h3>
        <label class="small" for="titleInput">ã‚¿ã‚¤ãƒˆãƒ«</label>
        <input id="titleInput" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" autocomplete="off" />
        <div style="height:8px"></div>
        <label class="small" for="noteInput">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
        <textarea id="noteInput" rows="10" placeholder="ã“ã®ãƒãƒ¼ãƒ‰ã®ãƒ¡ãƒ¢"></textarea>
        <div class="hint" style="margin-top:8px">å…¥åŠ›ã¯è‡ªå‹•ä¿å­˜ï¼ˆ2ç§’å¾Œï¼‰ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®URLã‚’é–‹ã„ãŸå„ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
      </div>
    </div>

    <div class="help">
      <details>
        <summary>â„¹ï¸ ä½¿ã„æ–¹ã®æ¦‚è¦ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹ãï¼‰</summary>
        <div class="hint" style="margin-top:8px">
          <ul>
            <li>ğŸ“Œ å·¦ã®ãƒ„ãƒªãƒ¼ã§ãƒãƒ¼ãƒ‰ã‚’é¸æŠ â†’ å³ã®ã€Œã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒ¡ãƒ¢ã€ã‚’ç·¨é›†ã™ã‚‹ã¨è‡ªå‹•ä¿å­˜ã€‚</li>
            <li>â• ãƒ«ãƒ¼ãƒˆ/å­ãƒãƒ¼ãƒ‰ã§éšå±¤è¿½åŠ ã€‚ãƒãƒ¼ãƒ‰å·¦ã®ã€Œï¼‹/âˆ’ã€ã§é–‹é–‰ã€‚</li>
            <li>ğŸ’¾ ä»–ç«¯æœ«ã¸ç§»ã™ã¨ãã¯ã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€â†’ JSON ã‚’ãƒ¡ãƒ¼ãƒ«ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ã§ç§»é€ â†’ å…ˆã§ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã€‚</li>
            <li>ğŸ§¹ ã€Œå…¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ã€ã¯ã“ã®URLä¸Šã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ï¼ˆå–ã‚Šæ¶ˆã—ä¸å¯ï¼‰ã€‚</li>
          </ul>
        </div>
      </details>
    </div>
  </div>

  <script>
    // ====== è¨­å®š ======
    const STORAGE_KEY = 'treeMemo.v1'; // ã“ã®URL(origin)ã”ã¨ã«åˆ†ã‹ã‚Œã¾ã™

    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    const uid = () => Math.random().toString(36).slice(2, 10);
    const nowStr = () => new Date().toLocaleString();
    const debounce = (fn,ms)=>{let t;return (...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms);}};

    // ====== ã‚¢ãƒ—ãƒªçŠ¶æ…‹ ======
    let state = { tree: [], selectedId: null, changed:false };

    // ====== ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ======
    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) state.tree = JSON.parse(raw);
        if (!Array.isArray(state.tree)) state.tree = [];
      }catch(e){ state.tree = []; }
    }
    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state.tree));
      qs('#saveState').textContent = 'ä¿å­˜æ¸ˆã¿';
      qs('#lastSaved').textContent = nowStr();
      state.changed = false;
    }
    const debounceSave = debounce(save, 2000);
    function markChanged(){ state.changed = true; qs('#saveState').textContent = 'æœªä¿å­˜*'; debounceSave(); }

    // ====== DOMãƒ˜ãƒ«ãƒ‘ ======
    const qs = (s, el=document)=> el.querySelector(s);

    // ====== æ¤œç´¢ ======
    function findNodeById(list, id, path=[]) {
      for (let i=0;i<list.length;i++){
        const n = list[i];
        if (n.id === id) return { node:n, parent:list, index:i, path };
        const deep = findNodeById(n.children||[], id, path.concat(n.title||'æœªå‘½å'));
        if (deep) return deep;
      }
      return null;
    }

    // ====== æ“ä½œ ======
    function addRoot(){
      const n = { id:uid(), title:'æ–°ã—ã„ãƒãƒ¼ãƒ‰', note:'', children:[], collapsed:false };
      state.tree.push(n); state.selectedId = n.id; markChanged(); render();
    }
    function addChild(){
      if (!state.selectedId) return;
      const res = findNodeById(state.tree, state.selectedId); if (!res) return;
      res.node.children = res.node.children || [];
      const n = { id:uid(), title:'å­ãƒãƒ¼ãƒ‰', note:'', children:[], collapsed:false };
      res.node.children.push(n); res.node.collapsed = false; state.selectedId = n.id; markChanged(); render();
    }
    function renameNode(){
      if (!state.selectedId) return; const res = findNodeById(state.tree, state.selectedId); if (!res) return;
      const t = prompt('æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«', res.node.title||''); if (t===null) return;
      res.node.title = (t||'').trim() || 'ç„¡é¡Œ'; markChanged(); render();
    }
    function deleteNode(){
      if (!state.selectedId) return; const res = findNodeById(state.tree, state.selectedId); if (!res) return;
      if (!confirm('ã“ã®ãƒãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿå­ã‚‚æ¶ˆãˆã¾ã™ã€‚')) return;
      res.parent.splice(res.index,1); state.selectedId = null; markChanged(); render();
    }
    function toggleCollapse(id){ const r = findNodeById(state.tree,id); if(!r) return; r.node.collapsed = !r.node.collapsed; markChanged(); render(); }
    function selectNode(id){
      state.selectedId = id; render();
      const res = findNodeById(state.tree, id);
      if (res){
        qs('#titleInput').value = res.node.title||'';
        qs('#noteInput').value = res.node.note||'';
        qs('#selectedPath').textContent = res.path.concat(res.node.title||'').join(' / ');
      } else {
        qs('#titleInput').value = ''; qs('#noteInput').value=''; qs('#selectedPath').textContent='â€”';
      }
    }
    function expandAll(){ const walk=l=>l.forEach(n=>{n.collapsed=false;walk(n.children||[])}); walk(state.tree); markChanged(); render(); }
    function collapseAll(){ const walk=l=>l.forEach(n=>{n.collapsed=true;walk(n.children||[])}); walk(state.tree); markChanged(); render(); }

    // ====== è©³ç´°ç·¨é›† ======
    function bindDetails(){
      const title = qs('#titleInput'); const note = qs('#noteInput');
      const onInput = ()=>{ if(!state.selectedId) return; const r=findNodeById(state.tree,state.selectedId); if(!r) return; r.node.title = title.value; r.node.note = note.value; markChanged(); render(); };
      title.addEventListener('input', debounce(onInput,200));
      note.addEventListener('input', debounce(onInput,200));
    }

    // ====== I/O ======
    function exportJson(){
      const blob = new Blob([JSON.stringify(state.tree,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a');
      a.href = url; a.download = 'tree-memo.json'; a.click(); URL.revokeObjectURL(url);
    }
    function importJson(file){
      const reader = new FileReader(); reader.onload = (e)=>{
        try{ const data = JSON.parse(e.target.result); if(!Array.isArray(data)) throw new Error('ä¸æ­£ãªå½¢å¼'); state.tree = data; state.selectedId = null; markChanged(); render(); }
        catch(err){ alert('èª­ã¿è¾¼ã¿å¤±æ•—: '+err.message); }
      }; reader.readAsText(file);
    }
    function resetAll(){ if(confirm('ã“ã®URLã§ä¿å­˜ã•ã‚ŒãŸå…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')){ localStorage.removeItem(STORAGE_KEY); state.tree=[]; state.selectedId=null; render(); save(); }}

    // ====== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ======
    function render(){
      const container = qs('#tree'); container.innerHTML='';
      const createLi = (n)=>{
        const li = document.createElement('li');
        const row = document.createElement('div'); row.className = 'node' + (state.selectedId===n.id?' selected':'');
        const tg = document.createElement('button'); tg.setAttribute('type','button'); tg.className='toggle'+((n.children&&n.children.length)?'':' hidden'); tg.textContent = n.collapsed?'+':'âˆ’'; tg.title='å±•é–‹/æŠ˜ã‚Šç•³ã¿'; tg.onclick=(e)=>{e.stopPropagation(); toggleCollapse(n.id)};
        const label = document.createElement('div'); label.className='label'; label.textContent = n.title||'ç„¡é¡Œ';
        row.appendChild(tg); row.appendChild(label); row.onclick = ()=> selectNode(n.id);
        li.appendChild(row);
        if (!n.collapsed && n.children && n.children.length){
          const ul = document.createElement('ul'); ul.className='tree'; n.children.forEach(c=> ul.appendChild(createLi(c))); li.appendChild(ul);
        }
        return li;
      };
      state.tree.forEach(n=> container.appendChild(createLi(n)));
    }

    // ====== ãƒã‚¤ãƒ³ãƒ‰ & èµ·å‹• ======
    function bindToolbar(){
      qs('#addRoot').onclick = addRoot; qs('#addChild').onclick = addChild; qs('#renameNode').onclick = renameNode; qs('#deleteNode').onclick = deleteNode;
      qs('#expandAll').onclick = expandAll; qs('#collapseAll').onclick = collapseAll; qs('#exportJson').onclick = exportJson; qs('#importJson').onclick = ()=> qs('#importFile').click();
      qs('#importFile').addEventListener('change', (e)=>{ const f=e.target.files[0]; if(f) importJson(f); e.target.value=''; });
      qs('#resetAll').onclick = resetAll;
    }

    function init(){
      load(); bindToolbar(); bindDetails(); render();
      qs('#lastSaved').textContent = localStorage.getItem(STORAGE_KEY)? nowStr() : 'â€”';
      qs('#saveState').textContent = 'ä¿å­˜æ¸ˆã¿';
      window.addEventListener('beforeunload', (e)=>{ if(state.changed){ e.preventDefault(); e.returnValue=''; } });
    }
    init();
  </script>
</body>
</html>
